!function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);(new class{constructor(){this.createElements(),this.request={}}createElements(){this.container=document.createElement("div"),this.container.id="container",this.chatWindow=document.createElement("div"),this.chatWindow.id="chat-window",this.chat=document.createElement("div"),this.chat.id="chat",this.users=document.createElement("div"),this.users.id="users",this.messageForm=document.createElement("form"),this.messageForm.id="message-form",this.messages=document.createElement("div"),this.messages.id="messages",this.messageText=document.createElement("textarea"),this.messageText.required=!0,this.messageText.name="message-text",this.messageText.id="message-text",this.messageSend=document.createElement("button"),this.messageSend.innerText="Отправить",this.messageSend.id="send",this.messageClear=document.createElement("button"),this.messageClear.innerText="Очистить",this.messageClear.id="clear",this.messageForm.append(this.messageText,this.messageSend,this.messageClear),this.chatWindow.append(this.users,this.messages,this.messageForm),this.container.append(this.chatWindow),this.loginWindow=document.createElement("div"),this.loginWindow.id="login-window",this.loginForm=document.createElement("form"),this.loginForm.id="login-form",this.loginName=document.createElement("input"),this.loginName.required=!0,this.loginName.name="login-name",this.loginName.id="login-name",this.loginSend=document.createElement("button"),this.loginSend.innerText="Войти",this.loginSend.id="send",this.loginForm.append(this.loginName,this.loginSend),this.loginWindow.append(this.loginForm),this.loginError=document.createElement("span"),this.loginError.innerText="Этот никнейм уже занят. Повторите попытку."}showMessage(e,t,s,n){const i=document.createElement("div");i.className="message",i.className=n;const a=document.createElement("span");a.innerText=`${e} | `;const r=document.createElement("span");r.innerText=t;const o=document.createElement("span");o.innerText=`: ${s}`,i.append(a,r,o),this.messages.insertAdjacentElement("beforeend",i)}connect(){this.ws=new WebSocket("wss://ws-homework.herokuapp.com/ws"),this.ws.addEventListener("open",(()=>{document.body.appendChild(this.loginWindow),this.loginForm.addEventListener("submit",(e=>{e.preventDefault(),this.username=this.loginName.value,this.request.user=this.loginName.value,this.request.type="login",this.ws.send(JSON.stringify(this.request))}))})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data);let s;switch(t.type){case"login":"false"===t.success?(this.loginName.value="",this.loginForm.appendChild(this.loginError)):(this.loginWindow.remove(),document.body.appendChild(this.container),this.container.appendChild(this.chatWindow),this.messageForm.addEventListener("submit",(e=>{e.preventDefault(),this.request.type="chatmessage",this.request.time=`${(new Date).toLocaleDateString()} ${(new Date).toLocaleTimeString()}`,this.request.message=this.messageText.value,this.ws.send(JSON.stringify(this.request)),this.messageText.value=""})),this.messageClear.addEventListener("click",(e=>{e.preventDefault(),this.messageText.value=""})),t.users.forEach((e=>{const t=document.createElement("span");t.innerText=e,this.users.insertAdjacentElement("beforeend",t)})));break;case"userLogin":s=document.createElement("span"),s.innerText=t.user,this.users.insertAdjacentElement("beforeend",s),this.showMessage(t.time,t.user,"Пользователь зашел в чат.","loginmessage");break;case"userLogout":Array.from(this.users.querySelectorAll("span")).forEach((e=>{e.innerText===t.user&&e.remove()})),this.showMessage(t.time,t.user,"Пользователь покинул чат.","logoutmessage");break;case"chatmessage":this.showMessage(t.time,t.user,t.message,"chatmessage");break;default:return}Array.from(this.chatWindow.querySelectorAll("span")).forEach((e=>{e.innerText===this.username&&(e.insertAdjacentHTML("afterend","<span>YOU</span>"),"chatmessage"===e.closest("div").className&&e.closest("div").classList.add("you"),e.remove())})),this.ws.addEventListener("close",(()=>{this.messageText.disabled="true",this.messageSend.disabled="true"})),this.ws.addEventListener("error",(e=>{this.showMessage(`${(new Date).toLocaleDateString()} ${(new Date).toLocaleTimeString()}`,"SERVER",e,"")}))}))}}).connect()}]);